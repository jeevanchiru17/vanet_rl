<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetSimulyzer GUI - VANET Visualization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            overflow: hidden;
        }

        #app {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        #sidebar {
            width: 350px;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        #sidebar h1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            font-size: 1.5em;
            text-align: center;
        }

        .section {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .section h2 {
            font-size: 1.1em;
            margin-bottom: 15px;
            color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            width: 100%;
            margin-bottom: 10px;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .stat-card {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.85em;
            color: #777;
            margin-top: 5px;
        }

        #file-input {
            display: none;
        }

        .file-label {
            display: block;
            background: #f0f0f0;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            border: 2px dashed #667eea;
            transition: all 0.3s;
        }

        .file-label:hover {
            background: #e8e8ff;
            border-color: #764ba2;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .checkbox-group input {
            margin-right: 10px;
            width: 18px;
            height: 18px;
        }

        /* Main Canvas */
        #main-content {
            flex: 1;
            position: relative;
            background: #1a1a2e;
        }

        #canvas-container {
            width: 100%;
            height: 100%;
        }

        /* Timeline */
        #timeline {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
        }

        #timeline-slider {
            width: 100%;
        }

        .timeline-info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9em;
        }

        /* Info Overlay */
        #info-overlay {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 12px;
            min-width: 250px;
        }

        .info-item {
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
        }

        .info-label {
            color: #aaa;
        }

        .info-value {
            color: #fff;
            font-weight: bold;
        }

        /* Loading */
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            display: none;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Node List */
        #node-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .node-item {
            background: #f5f5f5;
            padding: 10px;
            margin: 5px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .node-item:hover {
            background: #e8e8ff;
            transform: translateX(5px);
        }

        .node-item.selected {
            background: #667eea;
            color: white;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }
    </style>
</head>

<body>
    <div id="app">
        <!-- Sidebar -->
        <div id="sidebar">
            <h1>üöó NetSimulyzer GUI</h1>

            <!-- File Loading -->
            <div class="section">
                <h2>üìÅ Load Simulation</h2>
                <label for="file-input" class="file-label">
                    <div>üìÇ Click to load JSON file</div>
                    <div style="font-size: 0.8em; color: #999; margin-top: 5px;">
                        NS-3 NetSimulyzer output
                    </div>
                </label>
                <input type="file" id="file-input" accept=".json">
                <div id="file-name" style="margin-top: 10px; font-size: 0.9em; color: #666;"></div>
            </div>

            <!-- Statistics -->
            <div class="section">
                <h2>üìä Statistics</h2>
                <div class="stat-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-nodes">0</div>
                        <div class="stat-label">Nodes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-duration">0s</div>
                        <div class="stat-label">Duration</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-events">0</div>
                        <div class="stat-label">Events</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-series">0</div>
                        <div class="stat-label">Series</div>
                    </div>
                </div>
            </div>

            <!-- Playback Controls -->
            <div class="section">
                <h2>‚èØÔ∏è Playback</h2>
                <button class="btn" id="play-btn" disabled>‚ñ∂Ô∏è Play</button>
                <button class="btn" id="pause-btn" disabled>‚è∏Ô∏è Pause</button>
                <button class="btn" id="reset-btn" disabled>üîÑ Reset</button>

                <div class="control-group">
                    <label>Speed: <span id="speed-value">1.0x</span></label>
                    <input type="range" id="speed-slider" min="0.1" max="5" step="0.1" value="1" disabled>
                </div>
            </div>

            <!-- Display Options -->
            <div class="section">
                <h2>üé® Display</h2>
                <div class="checkbox-group">
                    <input type="checkbox" id="show-labels" checked>
                    <label for="show-labels">Show Node Labels</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="show-trails" checked>
                    <label for="show-trails">Show Motion Trails</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="show-grid" checked>
                    <label for="show-grid">Show Grid</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="show-connections">
                    <label for="show-connections">Show Connections</label>
                </div>
            </div>

            <!-- Node List -->
            <div class="section">
                <h2>üîç Nodes</h2>
                <div id="node-list"></div>
            </div>
        </div>

        <!-- Main Content -->
        <div id="main-content">
            <div id="canvas-container"></div>

            <!-- Loading -->
            <div id="loading">
                <div class="spinner"></div>
                <div>Loading simulation data...</div>
            </div>

            <!-- Info Overlay -->
            <div id="info-overlay">
                <div class="info-item">
                    <span class="info-label">Time:</span>
                    <span class="info-value" id="current-time">0.0s</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Active Nodes:</span>
                    <span class="info-value" id="active-nodes">0</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Camera:</span>
                    <span class="info-value">Drag to rotate</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Zoom:</span>
                    <span class="info-value">Scroll wheel</span>
                </div>
            </div>

            <!-- Timeline -->
            <div id="timeline">
                <input type="range" id="timeline-slider" min="0" max="100" value="0" disabled>
                <div class="timeline-info">
                    <span id="timeline-start">0.0s</span>
                    <span id="timeline-current">0.0s</span>
                    <span id="timeline-end">0.0s</span>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer;
        let simulationData = null;
        let nodes = [];
        let trails = [];
        let isPlaying = false;
        let currentTime = 0;
        let playbackSpeed = 1.0;
        let animationId = null;

        // Initialize Three.js scene
        function initScene() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);
            scene.fog = new THREE.Fog(0x1a1a2e, 500, 2000);

            camera = new THREE.PerspectiveCamera(
                60,
                (window.innerWidth - 350) / window.innerHeight,
                1,
                3000
            );
            camera.position.set(0, 500, 500);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth - 350, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(200, 300, 200);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            // Grid
            const gridHelper = new THREE.GridHelper(1000, 50, 0x667eea, 0x444444);
            gridHelper.name = 'grid';
            scene.add(gridHelper);

            // Controls
            addOrbitControls();
            window.addEventListener('resize', onWindowResize);

            animate();
        }

        function addOrbitControls() {
            let isDragging = false;
            let previousMouse = { x: 0, y: 0 };

            renderer.domElement.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMouse = { x: e.clientX, y: e.clientY };
            });

            renderer.domElement.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const deltaX = e.clientX - previousMouse.x;
                    const deltaY = e.clientY - previousMouse.y;

                    const radius = Math.sqrt(
                        camera.position.x ** 2 + camera.position.z ** 2
                    );
                    const angle = Math.atan2(camera.position.z, camera.position.x);
                    const newAngle = angle - deltaX * 0.005;

                    camera.position.x = radius * Math.cos(newAngle);
                    camera.position.z = radius * Math.sin(newAngle);
                    camera.position.y += deltaY * 0.5;
                    camera.position.y = Math.max(50, Math.min(1000, camera.position.y));

                    camera.lookAt(0, 0, 0);
                    previousMouse = { x: e.clientX, y: e.clientY };
                }
            });

            renderer.domElement.addEventListener('mouseup', () => {
                isDragging = false;
            });

            renderer.domElement.addEventListener('wheel', (e) => {
                e.preventDefault();
                const zoomSpeed = 20;
                const direction = new THREE.Vector3();
                camera.getWorldDirection(direction);

                if (e.deltaY < 0) {
                    camera.position.addScaledVector(direction, zoomSpeed);
                } else {
                    camera.position.addScaledVector(direction, -zoomSpeed);
                }
            });
        }

        function onWindowResize() {
            camera.aspect = (window.innerWidth - 350) / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth - 350, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            if (isPlaying && simulationData) {
                updateSimulation();
            }

            renderer.render(scene, camera);
        }

        // File loading
        document.getElementById('file-input').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('file-name').textContent = `üìÑ ${file.name}`;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        simulationData = JSON.parse(event.target.result);
                        loadSimulation();
                        document.getElementById('loading').style.display = 'none';
                    } catch (error) {
                        alert('Error loading file: ' + error.message);
                        document.getElementById('loading').style.display = 'none';
                    }
                };
                reader.readAsText(file);
            }
        });

        function loadSimulation() {
            // Clear existing
            nodes.forEach(node => scene.remove(node.mesh));
            trails.forEach(trail => scene.remove(trail));
            nodes = [];
            trails = [];

            // Update statistics
            const nodeCount = simulationData.nodes ? simulationData.nodes.length : 0;
            const duration = simulationData.configuration?.['time-step'] || 0;

            document.getElementById('stat-nodes').textContent = nodeCount;
            document.getElementById('stat-duration').textContent = duration.toFixed(1) + 's';
            document.getElementById('stat-events').textContent = '0';
            document.getElementById('stat-series').textContent = simulationData.series ? simulationData.series.length : 0;

            // Create nodes
            if (simulationData.nodes) {
                simulationData.nodes.forEach((nodeData, index) => {
                    createNode(nodeData, index);
                });
            }

            // Update node list
            updateNodeList();

            // Enable controls
            document.getElementById('play-btn').disabled = false;
            document.getElementById('pause-btn').disabled = false;
            document.getElementById('reset-btn').disabled = false;
            document.getElementById('speed-slider').disabled = false;
            document.getElementById('timeline-slider').disabled = false;

            // Set timeline
            document.getElementById('timeline-end').textContent = duration.toFixed(1) + 's';

            currentTime = 0;
            updateTimeDisplay();
        }

        function createNode(nodeData, index) {
            const geometry = new THREE.BoxGeometry(10, 5, 15);
            const material = new THREE.MeshStandardMaterial({
                color: 0x3b82f6,
                metalness: 0.5,
                roughness: 0.5
            });
            const mesh = new THREE.Mesh(geometry, material);
            mesh.castShadow = true;

            // Initial position
            mesh.position.set(0, 2.5, 0);

            scene.add(mesh);

            nodes.push({
                id: nodeData.id || index,
                mesh: mesh,
                data: nodeData,
                trailPoints: []
            });
        }

        function updateNodeList() {
            const nodeList = document.getElementById('node-list');
            nodeList.innerHTML = '';

            nodes.forEach((node, index) => {
                const item = document.createElement('div');
                item.className = 'node-item';
                item.textContent = `Node ${node.id}`;
                item.onclick = () => focusNode(node);
                nodeList.appendChild(item);
            });
        }

        function focusNode(node) {
            camera.position.set(
                node.mesh.position.x + 50,
                node.mesh.position.y + 50,
                node.mesh.position.z + 50
            );
            camera.lookAt(node.mesh.position);
        }

        function updateSimulation() {
            currentTime += 0.016 * playbackSpeed; // ~60fps

            // Update node positions based on time
            // This is simplified - you'd parse actual movement data from JSON
            nodes.forEach((node, index) => {
                const t = currentTime * 0.1;
                node.mesh.position.x = Math.sin(t + index) * 100;
                node.mesh.position.z = Math.cos(t + index) * 100;

                // Update trails
                if (document.getElementById('show-trails').checked) {
                    node.trailPoints.push(node.mesh.position.clone());
                    if (node.trailPoints.length > 50) {
                        node.trailPoints.shift();
                    }
                }
            });

            updateTimeDisplay();
        }

        function updateTimeDisplay() {
            document.getElementById('current-time').textContent = currentTime.toFixed(1) + 's';
            document.getElementById('timeline-current').textContent = currentTime.toFixed(1) + 's';

            const duration = parseFloat(document.getElementById('timeline-end').textContent);
            if (duration > 0) {
                const progress = (currentTime / duration) * 100;
                document.getElementById('timeline-slider').value = progress;
            }
        }

        // Controls
        document.getElementById('play-btn').addEventListener('click', () => {
            isPlaying = true;
        });

        document.getElementById('pause-btn').addEventListener('click', () => {
            isPlaying = false;
        });

        document.getElementById('reset-btn').addEventListener('click', () => {
            currentTime = 0;
            isPlaying = false;
            updateTimeDisplay();
        });

        document.getElementById('speed-slider').addEventListener('input', (e) => {
            playbackSpeed = parseFloat(e.target.value);
            document.getElementById('speed-value').textContent = playbackSpeed.toFixed(1) + 'x';
        });

        document.getElementById('timeline-slider').addEventListener('input', (e) => {
            const duration = parseFloat(document.getElementById('timeline-end').textContent);
            currentTime = (e.target.value / 100) * duration;
            updateTimeDisplay();
        });

        document.getElementById('show-grid').addEventListener('change', (e) => {
            const grid = scene.getObjectByName('grid');
            if (grid) grid.visible = e.target.checked;
        });

        // Initialize
        initScene();
    </script>
</body>

</html>